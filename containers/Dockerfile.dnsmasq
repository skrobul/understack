# syntax=docker/dockerfile:1
FROM alpine:3.19.1

LABEL org.opencontainers.image.title="dnsmasq for ironic deployed as openstack-helm"
LABEL org.opencontainers.image.base.name="ghcr.io/rackerlabs/understack/dnsmasq-alpine3.19.1"
LABEL org.opencontainers.image.source=https://github.com/rackerlabs/understack

RUN apk add --update --no-cache dnsmasq=2.90-r2 python3=3.11.8-r0 py3-pip=23.3.1-r0 py3-jinja2=3.1.2-r3

COPY common/helpers.sh /helpers.sh
COPY dnsmasq/entry-point.sh /entry-point.sh
RUN chmod +x /entry-point.sh
COPY dnsmasq/dnsmasq.conf.j2 /etc/dnsmasq.conf.j2
# let our entry point write out the script
RUN ln -sf /etc/dnsmasq.d/dnsmasq.conf /etc/dnsmasq.conf

EXPOSE 53/udp
EXPOSE 67/udp

ENTRYPOINT ["/entry-point.sh"]
CMD ["/usr/sbin/dnsmasq", "-d"]
